version: "3.9"
services:
  web:
    image: eduardogamer78/app1-php:prod-nginx-php-fpm8.2.3
    container_name: web
    build:
      context: .
      dockerfile: ./docker/Dockerfile
      args:
        PHP_VERSION: '8.2.4-fpm-bullseye'
    # volumes:
    #   - ./app:/var/www/app
    ports:
      - "${PM_PORT}:80" #http
    networks:
      - net_local
  
  mariadb:
      image: mariadb
      volumes:
        - ./sail-mariadb:/var/lib/mysql
      ports:
        - "${DB_PORT}:3306"
      environment:
        MYSQL_ROOT_PASSWORD: '${DB_ROOT_PASSWORD}'
        MYSQL_ROOT_HOST: '%'
        MYSQL_DATABASE: '${DB_DATABASE}'
        MYSQL_USER: '${DB_USERNAME}'
        MYSQL_PASSWORD: '${DB_PASSWORD}'
      networks:
        - net_local
      healthcheck:
          test: ["CMD", "mysqladmin", "ping"]
          retries: 3
          timeout: 5s
  
  phpmyadmin:
      image: phpmyadmin
      ports:
        - "${PMA_PORT}:80" #http
      depends_on:
        - "${DB_HOST}"
      networks:
        - net_local

networks:
    net_local:
        driver: bridge
volumes:
    sail-mariadb:
        driver: local
